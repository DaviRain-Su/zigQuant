# ZigQuant Agent Constitution

> æœ¬é¡¹ç›®çš„æ ¸å¿ƒå¼€å‘åŸåˆ™ä¸ AI ä»£ç†è¡Œä¸ºå‡†åˆ™

---

## ğŸ¯ é¡¹ç›®ä½¿å‘½

æ„å»ºä¸€ä¸ª**é«˜æ€§èƒ½ã€ä½å»¶è¿Ÿã€å†…å­˜å®‰å…¨**çš„é‡åŒ–äº¤æ˜“æ¡†æ¶ï¼Œç»“åˆ Hummingbot çš„åšå¸‚/å¥—åˆ©èƒ½åŠ›å’Œ Freqtrade çš„ç­–ç•¥å›æµ‹/è‡ªåŠ¨äº¤æ˜“èƒ½åŠ›ã€‚

---

## ğŸ“ æ ¸å¿ƒåŸåˆ™

### 1. æ–‡æ¡£ä¼˜å…ˆ (Documentation-First)

- **æ‰€æœ‰åŠŸèƒ½å¿…é¡»å…ˆæœ‰æ–‡æ¡£ï¼Œåæœ‰ä»£ç **
- Story å®šä¹‰éœ€æ±‚ â†’ Docs å®šä¹‰è®¾è®¡ â†’ Code å®ç°åŠŸèƒ½
- æ–‡æ¡£æ˜¯å”¯ä¸€çš„çœŸç›¸æ¥æº (Single Source of Truth)

### 2. å¢é‡è¿­ä»£ (Incremental Development)

- ä» MVP å¼€å§‹ï¼Œé€æ­¥æ·»åŠ åŠŸèƒ½
- æ¯ä¸ª Story å¿…é¡»å¯ç‹¬ç«‹æµ‹è¯•å’ŒéªŒè¯
- ä¼˜å…ˆäº¤ä»˜æ ¸å¿ƒä»·å€¼ï¼Œå»¶åä¼˜åŒ–

### 3. ä»£ç è´¨é‡

#### å†…å­˜å®‰å…¨
```zig
// âœ… å¥½çš„åšæ³•
pub fn processOrder(allocator: std.mem.Allocator, order: Order) !void {
    defer allocator.free(order.id);
    // ç¡®ä¿èµ„æºé‡Šæ”¾
}

// âŒ é¿å…
pub fn processOrder(order: Order) void {
    // å†…å­˜æ³„æ¼é£é™©
}
```

#### é”™è¯¯å¤„ç†
```zig
// âœ… æ˜¾å¼é”™è¯¯å¤„ç†
const result = try exchange.submitOrder(request);

// âŒ å¿½ç•¥é”™è¯¯
const result = exchange.submitOrder(request) catch unreachable;
```

#### æ€§èƒ½æ„è¯†
```zig
// âœ… ä½¿ç”¨ Arena Allocator å¤„ç†ä¸´æ—¶æ•°æ®
var arena = std.heap.ArenaAllocator.init(allocator);
defer arena.deinit();
const temp_data = try arena.allocator().alloc(u8, size);

// âŒ é¢‘ç¹åˆ†é…é‡Šæ”¾
for (items) |item| {
    const data = try allocator.alloc(u8, item.size);
    defer allocator.free(data);
}
```

### 4. å®‰å…¨ç¬¬ä¸€ (Security-First)

- **æ°¸è¿œä¸è¦ç¡¬ç¼–ç  API å¯†é’¥**
- æ‰€æœ‰æ•æ„Ÿæ•°æ®å¿…é¡»åŠ å¯†å­˜å‚¨
- æ‰€æœ‰äº¤æ˜“æ“ä½œå¿…é¡»å®¡è®¡æ—¥å¿—
- ç”Ÿäº§ç¯å¢ƒå¿…é¡»å¯ç”¨ ReleaseSafe æ¨¡å¼

### 5. æµ‹è¯•é©±åŠ¨ (Test-Driven)

- æ ¸å¿ƒæ¨¡å—æµ‹è¯•è¦†ç›–ç‡ > 90%
- æ¯ä¸ª Story å®Œæˆæ—¶å¿…é¡»æœ‰å¯¹åº”æµ‹è¯•
- ä½¿ç”¨ Mock è¿›è¡Œé›†æˆæµ‹è¯•
- æ€§èƒ½åŸºå‡†æµ‹è¯•å®šæœŸæ‰§è¡Œ

---

## ğŸ¤– AI ä»£ç†è¡Œä¸ºå‡†åˆ™

### ä»£ç ç”Ÿæˆ

1. **ç†è§£éœ€æ±‚**
   - ä»”ç»†é˜…è¯» Story å’Œç›¸å…³ Docs
   - å¦‚æœ‰ç–‘é—®ï¼Œå…ˆè¯¢é—®æ¾„æ¸…ï¼Œä¸è¦çŒœæµ‹

2. **è®¾è®¡ä¼˜å…ˆ**
   - å¤§å‹åŠŸèƒ½å…ˆå†™è®¾è®¡æ–‡æ¡£
   - è®¨è®ºæ¶æ„å†³ç­–
   - è€ƒè™‘è¾¹ç•Œæ¡ä»¶

3. **å®ç°è§„èŒƒ**
   - éµå¾ª Zig å®˜æ–¹é£æ ¼æŒ‡å—
   - ä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½å
   - æ·»åŠ å¿…è¦çš„æ³¨é‡Šï¼ˆä½†ä»£ç åº”è‡ªè§£é‡Šï¼‰
   - æ¯ä¸ªå…¬å…±å‡½æ•°å¿…é¡»æœ‰æ–‡æ¡£æ³¨é‡Š

4. **å¢é‡æäº¤**
   - å°æ­¥å¿«è·‘ï¼Œé¢‘ç¹éªŒè¯
   - æ¯æ¬¡åªå®Œæˆä¸€ä¸ªæ˜ç¡®çš„ä»»åŠ¡
   - ç¡®ä¿æ¯æ¬¡æäº¤éƒ½å¯ç¼–è¯‘

### æ–‡æ¡£ç»´æŠ¤

1. **åŒæ­¥æ›´æ–°**
   - ä»£ç å˜æ›´æ—¶ï¼ŒåŒæ­¥æ›´æ–°æ–‡æ¡£
   - Bug ä¿®å¤è®°å½•åœ¨å¯¹åº”çš„ bugs.md
   - æ–°å¢åŠŸèƒ½åœ¨ features/ ä¸‹åˆ›å»ºæ–‡æ¡£

2. **æ¸…æ™°è¡¨è¾¾**
   - ä½¿ç”¨ç®€æ´çš„è¯­è¨€
   - æä¾›ä»£ç ç¤ºä¾‹
   - ç»˜åˆ¶å¿…è¦çš„å›¾è¡¨

3. **å¯è¿½æº¯æ€§**
   - æ¯ä¸ª feature æ–‡æ¡£é“¾æ¥åˆ°å¯¹åº”çš„ story
   - æ–‡ä»¶è·¯å¾„ä½¿ç”¨ç›¸å¯¹è·¯å¾„
   - ä¿æŒæ–‡æ¡£ç»“æ„ä¸ä»£ç ç»“æ„ä¸€è‡´

### é—®é¢˜è§£å†³

1. **Bug ä¿®å¤æµç¨‹**
   ```
   å‘ç° Bug â†’ åœ¨ bugs.md è®°å½•
       â†“
   åˆ†ææ ¹å›  â†’ æ›´æ–° bugs.md
       â†“
   å®ç°ä¿®å¤ â†’ æ·»åŠ æµ‹è¯•
       â†“
   éªŒè¯ä¿®å¤ â†’ æ ‡è®°å·²è§£å†³
   ```

2. **æ€§èƒ½é—®é¢˜**
   - å…ˆæµ‹é‡ï¼Œåä¼˜åŒ–
   - ä½¿ç”¨ Profiler å®šä½ç“¶é¢ˆ
   - è®°å½•ä¼˜åŒ–å‰åçš„å¯¹æ¯”æ•°æ®

3. **è®¾è®¡å˜æ›´**
   - é‡å¤§å˜æ›´éœ€è¦ ADR (Architecture Decision Record)
   - è®¨è®ºæƒè¡¡å’Œå¤‡é€‰æ–¹æ¡ˆ
   - è¯„ä¼°å½±å“èŒƒå›´

---

## ğŸš« ç¦æ­¢äº‹é¡¹

### ä»£ç å±‚é¢

- âŒ ä½¿ç”¨ `@panic` æˆ– `unreachable`ï¼ˆé™¤éé€»è¾‘ä¸Šä¸å¯èƒ½ï¼‰
- âŒ å¿½ç•¥é”™è¯¯è¿”å›å€¼
- âŒ ç¡¬ç¼–ç é­”æ³•æ•°å­—
- âŒ è¿‡åº¦æŠ½è±¡ï¼ˆYAGNI åŸåˆ™ï¼‰
- âŒ æœªæµ‹è¯•çš„ä»£ç åˆå¹¶
- âŒ æäº¤æ³¨é‡Šæ‰çš„ä»£ç 

### å®‰å…¨å±‚é¢

- âŒ ç¡¬ç¼–ç å¯†é’¥/å¯†ç 
- âŒ ä»¥æ˜æ–‡è®°å½•æ•æ„Ÿä¿¡æ¯
- âŒ ç¦ç”¨å®‰å…¨æ£€æŸ¥
- âŒ ä½¿ç”¨ä¸å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
- âŒ è·³è¿‡è¾“å…¥éªŒè¯

### æµç¨‹å±‚é¢

- âŒ æ²¡æœ‰ Story å°±å¼€å§‹ç¼–ç 
- âŒ åŠŸèƒ½å®Œæˆä¸æ›´æ–°æ–‡æ¡£
- âŒ è·³è¿‡ä»£ç å®¡æŸ¥
- âŒ ç›´æ¥ä¿®æ”¹ç”Ÿäº§é…ç½®

---

## âœ… æ¨èå®è·µ

### å‘½åè§„èŒƒ

```zig
// ç±»å‹: PascalCase
pub const OrderManager = struct { ... };

// å‡½æ•°: camelCase
pub fn submitOrder(...) !Order { ... }

// å¸¸é‡: SCREAMING_SNAKE_CASE
pub const MAX_ORDERS: u32 = 1000;

// å˜é‡: snake_case
const order_id = "abc123";
```

### æ–‡ä»¶ç»„ç»‡

```
src/
â”œâ”€â”€ core/           # æ ¸å¿ƒç±»å‹å’Œå·¥å…·
â”œâ”€â”€ exchange/       # äº¤æ˜“æ‰€è¿æ¥å™¨
â”œâ”€â”€ strategy/       # ç­–ç•¥æ¡†æ¶
â”œâ”€â”€ backtest/       # å›æµ‹å¼•æ“
â””â”€â”€ utils/          # é€šç”¨å·¥å…·
```

### é”™è¯¯å¤„ç†å±‚æ¬¡

```zig
// 1. å¯æ¢å¤é”™è¯¯ - ä½¿ç”¨ error union
pub fn submitOrder(...) !Order { ... }

// 2. ç¼–ç¨‹é”™è¯¯ - ä½¿ç”¨ assert
std.debug.assert(amount.isPositive());

// 3. ä¸å¯èƒ½å‘ç”Ÿ - ä½¿ç”¨ unreachable (è°¨æ…)
switch (status) {
    .open, .filled => {},
    else => unreachable,  // å·²åœ¨ä¸Šå±‚è¿‡æ»¤
}
```

---

## ğŸ“Š è´¨é‡é—¨ç¦

æ¯ä¸ª Story å®Œæˆå‰å¿…é¡»æ£€æŸ¥ï¼š

- [ ] åŠŸèƒ½å®ç°å®Œæ•´
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡ (è¦†ç›–ç‡ > 85%)
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] ä»£ç å·²å®¡æŸ¥
- [ ] æ€§èƒ½è¾¾æ ‡ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] å®‰å…¨æ£€æŸ¥é€šè¿‡
- [ ] æ— ç¼–è¯‘è­¦å‘Š

---

## ğŸ”„ æŒç»­æ”¹è¿›

### æ¯å‘¨å›é¡¾

- æ£€æŸ¥ roadmap è¿›åº¦
- æ›´æ–°æŠ€æœ¯å€ºåŠ¡æ¸…å•
- è¯„ä¼°æ€§èƒ½æŒ‡æ ‡
- æ”¶é›†ç”¨æˆ·åé¦ˆ

### æ¯æœˆåæ€

- å›é¡¾æ¶æ„å†³ç­–
- è¯„ä¼°æŠ€æœ¯æ ˆé€‰æ‹©
- ä¼˜åŒ–å¼€å‘æµç¨‹
- æ›´æ–° Constitution

---

## ğŸ“ æ¨¡æ¿

### Story æ¨¡æ¿
å‚è§: `stories/templates/story-template.md`

### Feature æ–‡æ¡£æ¨¡æ¿
å‚è§: `docs/features/README.md`

### ADR æ¨¡æ¿
å‚è§: `docs/decisions/template.md`

---

## ğŸ“ å­¦ä¹ èµ„æº

- [Zig è¯­è¨€å‚è€ƒ](https://ziglang.org/documentation/master/)
- [Zig æ ‡å‡†åº“æ–‡æ¡£](https://ziglang.org/documentation/master/std/)
- [Freqtrade æ–‡æ¡£](https://www.freqtrade.io/)
- [Hummingbot æ–‡æ¡£](https://docs.hummingbot.org/)

---

*Last updated: 2025-01-22*
*Version: 1.0*
