# Time - Bug 追踪

> 已知问题、修复记录和解决方案

**最后更新**: 2025-01-22

---

## 当前已知问题

### 无重大问题

Time 模块当前没有已知的重大 Bug。

---

## 已修复问题

_暂无历史记录_

---

## 潜在改进

### 1. 闰秒处理

**描述**: 当前实现不处理闰秒

**影响**:
- 对于绝大多数量化交易场景无影响
- Unix 时间戳定义本身就忽略闰秒
- 交易所 API 通常也不处理闰秒

**解决方案**:
- 保持现状，文档中明确说明
- 如果未来需要高精度天文时间，考虑使用专门的时间库

**优先级**: 低

---

### 2. 时区支持

**描述**: 仅支持 UTC，不支持本地时区转换

**影响**:
- 内部计算统一使用 UTC，符合最佳实践
- 展示层可能需要时区转换

**解决方案**:
- 保持核心模块简单，仅使用 UTC
- 在 UI 层或日志层添加时区转换功能
- 可选：未来添加 `TimeZone` 模块

**优先级**: 低

---

### 3. 更多时间格式支持

**描述**: 仅支持 ISO 8601 格式

**影响**:
- ISO 8601 是国际标准，足够通用
- 某些场景可能需要其他格式（如 RFC 3339）

**解决方案**:
- 添加 `fromRFC3339()` 等方法
- 添加自定义格式解析器

**优先级**: 低

---

## 边界情况

### 1. 极值时间戳

**场景**: 使用 `i64` 最大/最小值

```zig
const max_ts = Timestamp.fromMillis(std.math.maxInt(i64));
const min_ts = Timestamp.fromMillis(std.math.minInt(i64));
```

**状态**: ✅ 正常工作

**说明**:
- i64 范围足够覆盖实际应用（约 ±2924 亿年）
- 运算可能溢出，调用方需注意

---

### 2. 闰年 2 月 29 日

**场景**: 解析闰年日期

```zig
const t = try Timestamp.fromISO8601("2024-02-29T00:00:00Z");
```

**状态**: ✅ 正常工作

**说明**: `daysSinceEpoch()` 使用 Gregorian 日历算法，正确处理闰年

---

### 3. 年份边界

**场景**: 跨年时间运算

```zig
const t1 = try Timestamp.fromISO8601("2024-12-31T23:59:59Z");
const t2 = t1.add(Duration.fromSeconds(1));
// t2 = 2025-01-01T00:00:00Z
```

**状态**: ✅ 正常工作

---

### 4. K线对齐边界

**场景**: 时间戳恰好在 K线边界

```zig
const t = try Timestamp.fromISO8601("2025-01-22T10:30:00Z");
const aligned = t.alignToKline(.@"5m");
// aligned 应该等于 t
```

**状态**: ✅ 正常工作

**说明**: `@divFloor` 确保正确的向下取整行为

---

## 性能问题

### 无性能瓶颈

所有操作均为 O(1) 或 O(n)（n 为字符串长度），性能符合预期。

---

## 报告 Bug

如果发现新的 Bug，请按以下格式报告：

### Bug 模板

```markdown
### Bug 标题

**描述**: 简要描述问题

**复现步骤**:
1. 步骤 1
2. 步骤 2
3. ...

**预期行为**: 应该发生什么

**实际行为**: 实际发生了什么

**代码示例**:
```zig
// 最小复现代码
const t = Timestamp.fromISO8601("...");
// ...
```

**环境**:
- Zig 版本: 0.13.0
- 操作系统: Linux/macOS/Windows
- zigQuant 版本: v0.1.0

**严重程度**: 低/中/高/致命
```

---

## 测试清单

发布前必须通过以下测试：

- [ ] 所有单元测试通过
- [ ] 边界测试通过
- [ ] 集成测试通过
- [ ] 基准测试性能达标
- [ ] 内存泄漏检查通过
- [ ] 跨平台测试通过（Linux, macOS, Windows）

---

## 相关文档

- [测试文档](./testing.md) - 完整的测试覆盖
- [实现细节](./implementation.md) - 算法说明
- [API 参考](./api.md) - 完整 API 文档

---

*Last updated: 2025-01-22*
