# Backtest Engine - å›æµ‹å¼•æ“

**ç‰ˆæœ¬**: v0.4.0 (è®¡åˆ’ä¸­)
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ
**å±‚çº§**: Strategy Layer
**ä¾èµ–**: Strategy Framework, Indicators Library, Market (OrderBook)

---

## ğŸ“‹ ç›®å½•

1. [åŠŸèƒ½æ¦‚è¿°](#åŠŸèƒ½æ¦‚è¿°)
2. [æ ¸å¿ƒç‰¹æ€§](#æ ¸å¿ƒç‰¹æ€§)
3. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
4. [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
5. [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)
6. [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## ğŸ¯ åŠŸèƒ½æ¦‚è¿°

Backtest Engine æ˜¯ zigQuant çš„å›æµ‹å¼•æ“ï¼Œä½¿ç”¨å†å²æ•°æ®éªŒè¯ç­–ç•¥æ•ˆæœã€‚

### è®¾è®¡ç›®æ ‡

- **å‡†ç¡®æ€§**: çœŸå®æ¨¡æ‹Ÿå¸‚åœºæ¡ä»¶
- **é«˜æ€§èƒ½**: å¿«é€Ÿå›æµ‹å¤§é‡å†å²æ•°æ®
- **æ˜“ç”¨æ€§**: ç®€å•çš„ API è®¾è®¡
- **å®Œæ•´æ€§**: è¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š

### å…³é”®æ¦‚å¿µ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Backtest Engine                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ Historical Data  â”‚ (Kçº¿æ•°æ®)              â”‚
â”‚  â”‚     Feed         â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                  â”‚
â”‚           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚     Strategy     â”‚ (ç­–ç•¥æ‰§è¡Œ)             â”‚
â”‚  â”‚    Executor      â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                  â”‚
â”‚           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚      Event       â”‚ (äº‹ä»¶æ¨¡æ‹Ÿ)             â”‚
â”‚  â”‚    Simulator     â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚           â”‚                                  â”‚
â”‚           â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚   Performance    â”‚ (ç»“æœåˆ†æ)             â”‚
â”‚  â”‚    Analyzer      â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. Historical Data Feed

åŠ è½½å’Œç®¡ç†å†å²Kçº¿æ•°æ®ï¼š

- CSV æ–‡ä»¶å¯¼å…¥
- æ•°æ®åº“æŸ¥è¯¢
- API è·å–ï¼ˆHyperliquidç­‰ï¼‰
- è‡ªå®šä¹‰æ•°æ®æº

### 2. Event Simulator

æ¨¡æ‹Ÿå¸‚åœºäº‹ä»¶ï¼š

- æ–°èœ¡çƒ›äº‹ä»¶
- è®¢å•æˆäº¤äº‹ä»¶
- æ»‘ç‚¹æ¨¡æ‹Ÿ
- æ‰‹ç»­è´¹è®¡ç®—

### 3. Performance Analyzer

æ€§èƒ½åˆ†æå’ŒæŠ¥å‘Šï¼š

- æ€»æ”¶ç›Š/äºæŸ
- èƒœç‡
- ç›ˆäºæ¯”
- å¤æ™®æ¯”ç‡
- æœ€å¤§å›æ’¤
- å¹³å‡æŒä»“æ—¶é—´

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```zig
const std = @import("std");
const zigQuant = @import("zigQuant");

pub fn main() !void {
    var gpa = std.heap.GeneralPurposeAllocator(.{}){};
    defer _ = gpa.deinit();
    const allocator = gpa.allocator();

    // 1. åˆ›å»ºç­–ç•¥
    const strategy = try DualMAStrategy.create(allocator, 10, 20);
    defer strategy.deinit();

    // 2. é…ç½®å›æµ‹
    const config = BacktestConfig{
        .pair = .{ .base = "ETH", .quote = "USDC" },
        .timeframe = .m15,
        .start_time = try Timestamp.fromISO8601("2024-01-01T00:00:00Z"),
        .end_time = try Timestamp.fromISO8601("2024-12-31T23:59:59Z"),
        .initial_capital = try Decimal.fromInt(10000),
        .commission_rate = try Decimal.fromFloat(0.001),
    };

    // 3. åˆ›å»ºå›æµ‹å¼•æ“
    var engine = BacktestEngine.init(allocator, logger);
    defer engine.deinit();

    // 4. è¿è¡Œå›æµ‹
    const result = try engine.run(strategy, config);

    // 5. æŸ¥çœ‹ç»“æœ
    std.debug.print("æ€»äº¤æ˜“æ¬¡æ•°: {}\n", .{result.total_trades});
    std.debug.print("èƒœç‡: {d:.2}%\n", .{result.win_rate * 100});
    std.debug.print("å‡€åˆ©æ¶¦: {}\n", .{result.net_profit});
    std.debug.print("å¤æ™®æ¯”ç‡: {d:.2}\n", .{result.sharpe_ratio});
    std.debug.print("æœ€å¤§å›æ’¤: {d:.2}%\n", .{result.max_drawdown * 100});
}
```

---

## ğŸ“Š æ€§èƒ½åˆ†æ

### BacktestResult

```zig
pub const BacktestResult = struct {
    // äº¤æ˜“ç»Ÿè®¡
    total_trades: u32,
    winning_trades: u32,
    losing_trades: u32,
    
    // ç›ˆäºç»Ÿè®¡
    total_profit: Decimal,
    total_loss: Decimal,
    net_profit: Decimal,
    
    // æ€§èƒ½æŒ‡æ ‡
    win_rate: f64,              // èƒœç‡
    profit_factor: f64,         // ç›ˆäºæ¯”
    sharpe_ratio: f64,          // å¤æ™®æ¯”ç‡
    max_drawdown: f64,          // æœ€å¤§å›æ’¤
    avg_trade_duration_minutes: f64,
    
    // è¯¦ç»†äº¤æ˜“è®°å½•
    trades: []Trade,
    equity_curve: []EquityPoint,
};
```

---

## âš¡ æ€§èƒ½æŒ‡æ ‡

- **å›æµ‹é€Ÿåº¦**: > 1000 candles/s
- **å†…å­˜å ç”¨**: < 200MB (10000 èœ¡çƒ› + ç­–ç•¥)
- **å‡†ç¡®æ€§**: ä¸å®ç›˜è¯¯å·® < 2%

---

**ç‰ˆæœ¬**: v0.4.0 (è®¡åˆ’ä¸­)
**çŠ¶æ€**: è®¾è®¡é˜¶æ®µ
**æ›´æ–°æ—¶é—´**: 2025-12-25
