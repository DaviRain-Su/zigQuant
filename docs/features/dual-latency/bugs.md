# Dual Latency Bug 追踪

> 双向延迟模拟模块的已知问题和潜在风险

**版本**: v0.7.0
**状态**: 📋 待开发
**最后更新**: 2025-12-27

---

## 当前状态

```
开放 Bug: 0
已修复: 0
待验证: 0
```

---

## 潜在问题

开发前识别的潜在风险点:

### P-001: 负延迟值

**风险等级**: 高

**描述**: Normal 分布可能产生负值，导致时间倒流。

**预防措施**:
```zig
pub fn sample(self: LatencyModel, rng: *Random) i64 {
    const raw = switch (self.model_type) {
        .Normal => self.sampleNormal(rng),
        // ...
    };
    // 确保非负
    return @max(0, raw);
}
```

### P-002: 时间戳溢出

**风险等级**: 中

**描述**: 极大延迟加上时间戳可能溢出 i64。

**预防措施**:
- 使用 saturating 算术
- 设置合理的 max_ns 限制
- 添加溢出检查

### P-003: 事件乱序

**风险等级**: 中

**描述**: 不同延迟可能导致后发事件先到达。

**说明**: 这是预期行为，反映真实世界情况。

**预防措施**:
- 文档说明此行为
- 使用优先队列管理事件
- 策略需要处理乱序事件

### P-004: 随机数质量

**风险等级**: 低

**描述**: 随机数生成器质量影响 Normal 分布准确性。

**预防措施**:
- 使用高质量 RNG (如 Xoshiro256**)
- 提供种子配置用于复现
- 验证分布统计特性

### P-005: 历史数据格式

**风险等级**: 低

**描述**: Interpolated 模式下历史数据格式问题。

**预防措施**:
- 定义明确的数据格式
- 添加数据验证
- 处理空数据情况

---

## Bug 模板

```markdown
### BUG-XXX: [简短描述]

**状态**: 🔴 开放 | 🟡 进行中 | 🟢 已修复
**优先级**: P0 | P1 | P2
**发现版本**: v0.7.0
**修复版本**: -

**描述**:
[详细描述问题]

**复现步骤**:
1. 步骤 1
2. 步骤 2
3. 预期结果 vs 实际结果

**根因分析**:
[分析原因]

**修复方案**:
[描述修复]

**测试验证**:
- [ ] 单元测试
- [ ] 集成测试
- [ ] 手动验证

**相关代码**:
- `src/backtest/latency.zig:XXX`
```

---

## 修复历史

暂无修复记录。

---

*Last updated: 2025-12-27*
